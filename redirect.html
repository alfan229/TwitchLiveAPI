<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OAuth Redirect</title>
    <script>
        // This function runs once the page is fully loaded.
        window.onload = function() {
            // Extract the hash (#) part of the URL, which contains the access token and other parameters.
            const hash = window.location.hash.substring(1);
            const params = new URLSearchParams(hash);

            // Extract the access token from the parameters.
            const accessToken = params.get('access_token');
            const scope = params.get('scope'); // Optional: Extract additional parameters as needed.
            const tokenType = params.get('token_type'); // Optional: Extract additional parameters as needed.

            if (accessToken) {
                // If there's an access token, post a message containing the token back to the opener window.
                // This requires the extension's content or background script to be listening for messages.
                window.opener.postMessage({
                    type: 'twitchOAuthToken',
                    accessToken: accessToken,
                    scope: scope, // Optional: Include additional data as needed.
                    tokenType: tokenType // Optional: Include additional data as needed.
                }, "*"); // Consider specifying a more restrictive target origin for increased security.
            } else {
                // If no access token is found, send an error message.
                window.opener.postMessage({ type: 'twitchOAuthError', error: 'Access Token not found' }, "*");
            }

            // Close the popup window after sending the message.
            window.close();
        };
    </script>
</head>
<body>
    <p>Please wait...</p>
</body>
</html>
